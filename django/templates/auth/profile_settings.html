{% extends 'base_generic.html' %} {% block content %} {% load static %}

<div class="container" style="color: white;">
  <div class="align-items-center justify-content-center d-flex">
    <div class="pt-3 flex-col w-50">
      <h1><b>Profile details</b></h1>
      <hr class="solid" />
      
      <div class="mt-3 text-center d-flex align-items-center">
        <h3>Email</h3>
      </div>
      <p>{{ user.email }}</p>
      <form>
      <div class="d-flex align-items-center">
        <h3>Username</h3><label for="username-input"><i class="bi bi-pencil-fill" style="color: #0085FF;margin-left: 2vw;"></i></label><button type="button" onclick="changeUsername()" class="btn" style="background: #2D2D2D;color: white;margin-left: 2vw;">Update</button>
      </div>
        <input id="username_input" class="form-control w-50 my-1" name="username" style="background: #2D2D2D;border: none;color: white;" placeholder="{{user.username}}" required></input>
      <div class="row pt-3">
      </form>
      <h3>Password</h3>
      </div>
      <form action="{% url 'password_reset' %}" method="POST">
        {% csrf_token %}
        <div hidden>
          <input 
            type="email"
            id="email"
            name="email"
            value="{{user.email}}"/>
        </div>
        <button href="{% url 'password_reset' %}" class="btn" style="background: #2D2D2D;color: #CBCBCB;">Request password change</button>
      </form>
    <div class="d-flex flex-row-reverse">
      <a href="{% url 'user-delete' %}" class="mt-5 btn d-block" style="color: #CBCBCB;background: #AA4747;">Delete account</a>
      </div>
    </div>
  </div>
</div>
<script>
  function changeUsername() {
    const username_input = document.getElementById("username_input")
    const formData = {
      'username': username_input.value,
    }
    $.ajax({
      url: '{% url 'user-update' %}',
      type: 'PUT',
      headers: {
          'X-CSRFToken': Cookies.get('csrftoken')
      },
      data: formData,
      success: function(response) {
        window.location.reload();
      },
      error: function(response) {
        username_input.style.background_color = "red";
      },
    })
  }
</script>
{% endblock %}
